name: unusual working hours
type: anomaly-triggering
purpose: this detection identifies employees that access patient medical records during times of the day that are unusual based on historical behaviour.
prerequisites: 
- indexes: 
          anomaly_collection
- lookups: 
          baseline_working_hours
- macros: 
- fields: 
          staff_ID
          patient_ID
- searches: 
          search 1
how_to_implement:

search 1: 
- description: 
- search: 
 tag=emraudit staff_ID=* patient_ID=* earliest=-7d
 | fields _time, staff_ID, patient_ID
 | eval hourOfDay = strptime(_time, "%H")
 | stats count by hourOfDay, staff_ID
 | lookup baseline_working_hours staff_ID hourOfDay OUTPUT historical_percent
 | where isnull(historical_percent) OR historical_percent<=1
 |  
 
- time range picker: 
- cron schedule: 
