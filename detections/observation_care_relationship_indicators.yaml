name: care relationship indicators
type: observation-triggering
description: 
          This detection looks for specific signals that may indicate the existence of a legitimate care relationship between 
          an employee and a patient. While it does not represent suspicious behavior, it provides important context when grouping 
          anomalies to surface alerts, and/or when investigating alerts, helping to distinguish between acceptable and unacceptable behaviour.
          For each match, an observation is created and stored as an event in index=observation_collection.
detection_ID: ant5
prerequisites:
- data sources:
          
- indexes: 
          observation_collection
- lookups: 
          N/A
- macros: 
- fields: 
          staff_ID
          patient_ID
          
- searches: 
          search_1
          search_2
how_to_implement:

search_1: 
- description: This search creates and maintains a baseline of access hours to patient medical records for each staff member. It identifies the least commonly used hours (rare) by staff_ID and stores the results in a lookup table (baseline_access_hours) for further use in search_2 to detect anomalies.
- search: 
 tag=emraudit staff_ID=* patient_ID=* earliest=-30d
 | fields _time, staff_ID
 | eval hourOfDay = strptime(_time, "%H")
 | rare hourOfDay by staff_ID
 | fields staff_ID, hourOfDay, percent
 | outputlookup baseline_access_hours
- time range picker: N/A (the time window for the search is defined in the search itself via the earliest and latest options).
- cron schedule: * * * * *
